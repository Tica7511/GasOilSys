
<ul id="Oalllist" class='nav'>
    <li>
        <a name="menubtn" href="javascript:void(0);" link='OilInfo.aspx' target='_self'>石油業者基本資料</a>
    </li>
    <li>
        <a href='#' id="storageList" target='_self'>儲油設施基本資料</a>
        <ul class='navSa'>
            <li><a name="menubtn" href="javascript:void(0);" link='OilReservoir.aspx' target='_self'>庫區基本資料</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankInfo.aspx' target='_self'>儲槽基本資料</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankBWT.aspx' target='_self'>儲槽基礎、壁板、頂板</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankButton.aspx' target='_self'>儲槽底板</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilButtonChange.aspx' target='_self'>底板更換紀錄</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilCathodicProtection.aspx' target='_self'>陰極防蝕系統</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTankPipeline.aspx' target='_self'>槽區管線</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilInternalAudit.aspx' target='_self'>內部稽核</a></li>
        </ul>
    </li>
    <li>
        <a href='#' id="pipeList" target='_self'>管線管理</a>
        <ul class='navSb'>
            <li><a name="menubtn" href="javascript:void(0);" link='OilAreaLongPipeline.aspx' target='_self'>轄區長途管線方塊圖</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilLongPipeline.aspx' target='_self'>長途管線路徑圖</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTubeInfo.aspx' target='_self'>石油管線基本資料</a></li>
            <!--<li><a name="menubtn" href="javascript:void(0);" link='OilTubeEnvironment.aspx' target='_self'>管線路徑環境特質</a></li>-->
            <li><a name="menubtn" href="javascript:void(0);" link='OilTubeComplete.aspx' target='_self'>管線完整性管理作為</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilCheckSmartTubeCleaner.aspx' target='_self'>智慧型通管器檢查(ILI)</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilCIPS.aspx' target='_self'>緊密電位檢測(CIPS)</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilUnusualRectifier.aspx' target='_self'>異常整流站</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTubeCheck.aspx' target='_self'>管線巡檢</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTubeMaintain.aspx' target='_self'>管線維修或開挖</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilRiskAssessment.aspx' target='_self'>風險評估</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilInsideInspect.aspx' target='_self'>內部稽核</a></li>
        </ul>
    </li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilControl.aspx' target='_self'>控制室</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilAccidentLearning.aspx' target='_self'>事故學習</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilSelfEvaluation.aspx' target='_self'>查核項目自評</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilReportUpload.aspx' target='_self'>查核簡報上傳</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilOnlineEvaluation.aspx' target='_self'>查核佐證資料上傳</a></li>
    <!--<li id="PipeManagementlist"><a name="PipeManagementbtn" href="javascript:void(0);" target="_blank">圖資查詢</a></li>-->
    <li class="Oconfirmlist"><a name="Oconfirmbtn" href="javascript:void(0);">資料確認</a></li>
</ul>

<ul id="Ostoragelist" class='nav'>
    <li>
        <a name="menubtn" href="javascript:void(0);" link='OilInfo.aspx' target='_self'>石油業者基本資料</a>
    </li>
    <li>
        <a href='#' id="storageList" target='_self'>儲油設施基本資料</a>
        <ul class='navSa'>
            <li><a name="menubtn" href="javascript:void(0);" link='OilReservoir.aspx' target='_self'>庫區基本資料</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankInfo.aspx' target='_self'>儲槽基本資料</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankBWT.aspx' target='_self'>儲槽基礎、壁板、頂板</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankButton.aspx' target='_self'>儲槽底板</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilButtonChange.aspx' target='_self'>底板更換紀錄</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilCathodicProtection.aspx' target='_self'>陰極防蝕系統</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTankPipeline.aspx' target='_self'>槽區管線</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilInternalAudit.aspx' target='_self'>內部稽核</a></li>
        </ul>
    </li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilControl.aspx' target='_self'>控制室</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilAccidentLearning.aspx' target='_self'>事故學習</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilSelfEvaluation.aspx' target='_self'>查核項目自評</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilReportUpload.aspx' target='_self'>查核簡報上傳</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilOnlineEvaluation.aspx' target='_self'>查核佐證資料上傳</a></li>
    <!--<li id="PipeManagementlist"><a name="PipeManagementbtn" href="javascript:void(0);" target="_blank">圖資查詢</a></li>-->
    <li class="Oconfirmlist"><a name="Oconfirmbtn" href="javascript:void(0);">資料確認</a></li>
</ul>

<ul id="Onopipelist" class='nav'>
    <li>
        <a name="menubtn" href="javascript:void(0);" link='OilInfo.aspx' target='_self'>石油業者基本資料</a>
    </li>
    <li>
        <a href='#' id="pipeList" target='_self'>管線管理</a>
        <ul class='navSb'>
            <li><a name="menubtn" href="javascript:void(0);" link='OilAreaLongPipeline.aspx' target='_self'>轄區長途管線方塊圖</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilLongPipeline.aspx' target='_self'>長途管線路徑圖</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTubeInfo.aspx' target='_self'>石油管線基本資料</a></li>
            <!--<li><a name="menubtn" href="javascript:void(0);" link='OilTubeEnvironment.aspx' target='_self'>管線路徑環境特質</a></li>-->
            <li><a name="menubtn" href="javascript:void(0);" link='OilTubeComplete.aspx' target='_self'>管線完整性管理作為</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilCheckSmartTubeCleaner.aspx' target='_self'>智慧型通管器檢查(ILI)</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilCIPS.aspx' target='_self'>緊密電位檢測(CIPS)</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilUnusualRectifier.aspx' target='_self'>異常整流站</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTubeCheck.aspx' target='_self'>管線巡檢</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTubeMaintain.aspx' target='_self'>管線維修或開挖</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilRiskAssessment.aspx' target='_self'>風險評估</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilInsideInspect.aspx' target='_self'>內部稽核</a></li>
        </ul>
    </li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilControl.aspx' target='_self'>控制室</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilAccidentLearning.aspx' target='_self'>事故學習</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilSelfEvaluation.aspx' target='_self'>查核項目自評</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilReportUpload.aspx' target='_self'>查核簡報上傳</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilOnlineEvaluation.aspx' target='_self'>查核佐證資料上傳</a></li>
    <!--<li id="PipeManagementlist"><a name="PipeManagementbtn" href="javascript:void(0);" target="_blank">圖資查詢</a></li>-->
    <li class="Oconfirmlist"><a name="Oconfirmbtn" href="javascript:void(0);">資料確認</a></li>
</ul>

<ul id="Ononelist" class='nav'>
    <li>
        <a name="menubtn" href="javascript:void(0);" link='OilInfo.aspx' target='_self'>石油業者基本資料</a>
    </li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilControl.aspx' target='_self'>控制室</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilAccidentLearning.aspx' target='_self'>事故學習</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilSelfEvaluation.aspx' target='_self'>查核項目自評</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilReportUpload.aspx' target='_self'>查核簡報上傳</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilOnlineEvaluation.aspx' target='_self'>查核佐證資料上傳</a></li>
    <!--<li id="PipeManagementlist"><a name="PipeManagementbtn" href="javascript:void(0);" target="_blank">圖資查詢</a></li>-->
    <li class="Oconfirmlist"><a name="Oconfirmbtn" href="javascript:void(0);">資料確認</a></li>
</ul>

<ul id="OOceanlist" class='nav'>
    <li>
        <a name="menubtn" href="javascript:void(0);" link='OilInfo.aspx' target='_self'>石油業者基本資料</a>
    </li>
    <li>
        <a href='#' id="storageList" target='_self'>儲油設施基本資料</a>
        <ul class='navSa'>
            <li><a name="menubtn" href="javascript:void(0);" link='OilReservoir.aspx' target='_self'>庫區基本資料</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankInfo.aspx' target='_self'>儲槽基本資料</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankBWT.aspx' target='_self'>儲槽基礎、壁板、頂板</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilStorageTankButton.aspx' target='_self'>儲槽底板</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilButtonChange.aspx' target='_self'>底板更換紀錄</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilCathodicProtection.aspx' target='_self'>陰極防蝕系統</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilTankPipeline.aspx' target='_self'>槽區管線</a></li>
            <li><a name="menubtn" href="javascript:void(0);" link='OilInternalAudit.aspx' target='_self'>內部稽核</a></li>
        </ul>
    </li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilControl.aspx' target='_self'>控制室</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilAccidentLearning.aspx' target='_self'>事故學習</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilSelfEvaluation.aspx' target='_self'>查核項目自評</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilReportUpload.aspx' target='_self'>查核簡報上傳</a></li>
    <li><a name="menubtn" href="javascript:void(0);" link='OilOnlineEvaluation.aspx' target='_self'>查核佐證資料上傳</a></li>
    <!--<li id="PipeManagementlist"><a name="PipeManagementbtn" href="javascript:void(0);" target="_blank">圖資查詢</a></li>-->
    <li class="Oconfirmlist"><a name="Oconfirmbtn" href="javascript:void(0);">資料確認</a></li>
</ul>

<script type="text/javascript">

    $(document).ready(function () {

        //$(".Oconfirmlist").append('<a name="Oconfirmbtn" href="javascript:void(0);" >資料確認</a>');

        //取消資料確認視窗
        $(document).on("click", "#mgcancelbtn", function () {
            $.magnificPopup.close();
        });

        //資料確認開窗
        $("a[name='Oconfirmbtn']").click(function () {
            //$("#mgsellist").append('<option value="' + getTaiwanDate() + '">' + getTaiwanDate() + '</option>');
            //getOilConfirmData(getTaiwanDate());
            //doOpenMagPopupConfirmData();

            if (confirm("點選確定後今年度所有頁面之檔案以及資料(不包含自評表)將無法做修正，是否確定資料都已正確?")) {

                // Create an FormData object
                var data = new FormData();

                // If you want to add an extra field for the FormData
                data.append("type", "Oil");
                data.append("cpid", $.getQueryString("cp"));
                data.append("year", getTaiwanDate());
                data.append("category", "confirm");

                $.ajax({
                    type: "POST",
                    async: false, //在沒有返回值之前,不會執行下一步動作
                    url: "../handler/AddCompanyCheck.aspx",
                    data: data,
                    processData: false,
                    contentType: false,
                    cache: false,
                    error: function (xhr) {
                        alert("Error: " + xhr.status);
                        console.log(xhr.responseText);
                    },
                    success: function (data) {
                        if ($(data).find("Error").length > 0) {
                            alert($(data).find("Error").attr("Message"));
                        }
                        else {
                            alert($("Response", data).text());

                            location.href = "OilInfo.aspx?cp=" + $.getQueryString("cp");
                        }
                    }
                });
            }
        });

        $.ajax({
            type: "POST",
            async: false, //在沒有返回值之前,不會執行下一步動作
            url: "../Handler/GetCompanyName.aspx",
            data: {
                type: "Oil",
                cpid: $.getQueryString("cp"),
            },
            error: function (xhr) {
                alert("Error: " + xhr.status);
                console.log(xhr.responseText);
            },
            success: function (data) {
                if ($(data).find("Error").length > 0) {
                    alert($(data).find("Error").attr("Message"));
                }
                else {
                    if ($(data).find("data_item").length > 0) {
                        $(data).find("data_item").each(function (i) {
                            var cpid = $(this).children("guid").text().trim();
                            var pipeDisplay = $(this).children("管線管理不顯示").text().trim();
                            var storageDisplay = $(this).children("儲槽設施不顯示").text().trim();
                            var dataConfirm = $(this).children("資料是否確認").text().trim();
                            var competence = $(this).children("competence").text().trim();

                            $("#storageTB").val(storageDisplay);
                            $("#tubeTB").val(pipeDisplay);

                            if (cpid == 'E2657112-E87C-4112-916C-27A849A77B4C') {
                                $("#Oalllist").hide();
                                $("#Onopipelist").hide();
                                $("#Ostoragelist").hide();
                                $("#Ononelist").hide();
                                $("#OOceanlist").show();
                            }
                            else {
                                if ((pipeDisplay == 'N') && (storageDisplay == 'N')) {
                                    $("#Oalllist").hide();
                                    $("#Onopipelist").hide();
                                    $("#Ostoragelist").hide();
                                    $("#Ononelist").show();
                                    $("#OOceanlist").hide();
                                }
                                else if ((pipeDisplay == 'N') && (storageDisplay != 'N')) {
                                    $("#Oalllist").hide();
                                    $("#Onopipelist").hide();
                                    $("#Ostoragelist").show();
                                    $("#Ononelist").hide();
                                    $("#OOceanlist").hide();
                                }
                                else if ((pipeDisplay != 'N') && (storageDisplay == 'N')) {
                                    $("#Oalllist").hide();
                                    $("#Onopipelist").show();
                                    $("#Ostoragelist").hide();
                                    $("#Ononelist").hide();
                                    $("#OOceanlist").hide();
                                }
                                else {
                                    $("#Oalllist").show();
                                    $("#Onopipelist").hide();
                                    $("#Ostoragelist").hide();
                                    $("#Ononelist").hide();
                                    $("#OOceanlist").hide();
                                }
                            }

                            if (dataConfirm == '是' || competence == '01' || competence == '05' || competence == '06')
                                $(".Oconfirmlist").empty();
                        });
                    }
                }
            }
        });

        $.ajax({
            type: "POST",
            async: false, //在沒有返回值之前,不會執行下一步動作
            url: "../Handler/GetCompanyName.aspx",
            data: {
                type: "Oil",
                cpid: $.getQueryString("cp"),
            },
            error: function (xhr) {
                alert("Error: " + xhr.status);
                console.log(xhr.responseText);
            },
            success: function (data) {
                if ($(data).find("Error").length > 0) {
                    alert($(data).find("Error").attr("Message"));
                }
                else {
                    if ($(data).find("data_item2").length > 0) {

                        $(data).find("data_item2").each(function (i) {
                            $("#PipeManagementlist").show();
                            $("a[name='PipeManagementbtn']").attr("href", "http://23.99.109.107/ncree2/home/map.aspx?sta=" + $(this).children("場站").text().trim());
                        });
                    }
                    else {
                        $("#PipeManagementlist").hide();
                    }
                }
            }
        });

        var pathAry = window.location.pathname.split('/');
        var pathName = pathAry[(pathAry.length - 1)];
        var pathNameAry = pathName.split('_');
        var pathParentName = pathNameAry[(pathNameAry.length - 1)];
        $("#navmenuV a[link='" + pathParentName + "']").parent().addClass("active");
        $("#navmenuV a[link='" + pathParentName + "']").parent().parent().parent().addClass("open");
        $('.nav').navgoco();

        $("a[name='menubtn']").click(function () {
            location.href = ($.getQueryString("cp") != "") ? $(this).attr("link") + "?cp=" + $.getQueryString("cp") : $(this).attr("link");
        });
    });
</script>